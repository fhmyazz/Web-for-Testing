<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-blue-500 p-4">
        <div class="max-w-2xl mx-auto flex justify-between items-center">

            <h1 class="text-white text-xl font-bold">Post App</h1>
            <div class="flex gap-3">
                <button
                    onclick="window.location.href = 'create-post.html'"
                    id="create-button"
                    class="bg-green-500 text-white px-4 py-1 rounded hover:bg-green-600">
                        + New Post
                </button>

                <button
                    onclick="logout()"
                    id="logout-button"
                    class="bg-red-500 text-white px-4 py-1 rounded hover:bg-red-600">
                        Logout
                </button>

            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-8">
        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <span id="error-text"></span>
        </div>

        <div id="loading" class="text-center text-gray-500 py-8">
            Loading Posts...
        </div>

        <div id="empty-state" class="hidden text-center text-gray-500 py-8">
            <p>No Post yet</p>
            <a href="create-post.html" class="text-blue-500 hover:underline">Create your first post here</a>
        </div>

        <div id="posts-container" class="hidden"></div>
    </div>
    <script>
        const loading = document.getElementById('loading')
        const newPost = document.getElementById('create-button')
        const emptyState = document.getElementById('empty-state')
        const postsContainer = document.getElementById('posts-container')
        const errorDiv = document.getElementById('error-message')
        const errorText = document.getElementById('error-text')
        const token = localStorage.getItem('token')

        if(!token){
            window.location.href = 'login.html'
        }

        async function loadPosts(){
            try{
                const response = await fetch('http://localhost:3000/api/posts', {
                    headers: {'Authorization': `Bearer ${token}`}
                })
                const data = await response.json()
                console.log(data)
                loading.classList.add('hidden')

                if(response.ok){
                    const posts = data.data.posts

                    if(posts.length === 0){
                        emptyState.classList.remove('hidden')
                    }else{
                        postsContainer.classList.remove('hidden')
                        posts.forEach(post => renderPost(post))
                    }
                }else{
                    showError(data.error)
                }
            }catch(error){
                loading.classList.add('hidden')
                showError('Network Error. Please try again later.')
            }
        }
        loadPosts()

        function showError(message){
            errorText.textContent = message
            errorDiv.classList.remove('hidden')
        }

        function renderPost(post){
            const container = postsContainer
            const card = document.createElement('div')

            card.className = 'bg-white p-6 rounded-lg mb-4'
            card.innerHTML = `
                <h2 class="text-xl font-bold mb-2">${post.title}</h2>
                <p class="text-gray-600">${post.content}</p>
            `

            container.appendChild(card)
        }

        function logout(){
            window.location.href = 'login.html'
            localStorage.removeItem('token')
            localStorage.removeItem('usrname')
        }
    </script>
</body>
</html>